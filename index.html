<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorios para uso del sector espacial - New Space</title>
    <link rel="stylesheet" href="leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #F2F2F2;
            color: #333;
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
        }

        .header {
            background-color: #0D3B66;
            color: #FFFFFF;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .header img {
            height: 50px;
            margin-right: 15px;
        }
        .header h1 {
            font-size: 24px;
            margin: 0;
        }
        .header h2 {
            font-size: 16px;
            margin: 0;
            font-weight: 300;
        }

        #map {
            height: 600px;
            flex-grow: 1;
            border: 2px solid #0D47A1;
        }

        #sidebar {
            width: 300px;
            height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: #fff;
        }

        .lab-item {
            cursor: pointer;
            padding: 5px;
            border-bottom: 2px solid #000;
        }
        .lab-item:hover {
            background-color: #f0f0f0;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header img {
                margin-bottom: 10px;
            }
            #sidebar {
                width: 100%;
                height: auto;
                padding: 10px;
            }
            #map {
                height: 400px;
            }
            .container {
                display: flex;
                flex-direction: column;
            }
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    
  
    <div class="header">
        <img src="/images/conae_logo.png" alt="Logo CONAE">
        <div>
            <h1>Laboratorios para uso del sector espacial</h1>
            <h2>Mapa interactivo de capacidades, infraestructura y servicios</h2>
            <h3>Secretaría de Innovación, Ciencia y Tecnología</h3>
        </div>
    </div>
    
    <div class="container" style="display: flex;">
        <div id="sidebar"></div>
        <div id="map"></div>
    </div>
    <script src="leaflet.js"></script>
    <script>
        var map = L.map('map').setView([-38.5, -63.5], 5);
        
        var laboratorioIcon = L.icon({
    iconUrl: '/images/iconlab_blue.png',  // Ruta a tu icono
    iconSize: [58, 57],  // Tamaño en píxeles [ancho, alto]
    //iconAnchor: [29, 57],  // Punto de anclaje (centro abajo)
    //popupAnchor: [0, 0]  // Desplazamiento del popup
});

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: 'Map data &copy; OpenStreetMap contributors',
        }).addTo(map);

        fetch('provincias.geojson')
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, {
                    style: { color: '#fff', weight: 1, fillColor: '#1E90FF', fillOpacity: 0.6 },
                    onEachFeature: function(feature, layer) {
                        layer.on('mouseover', function() { layer.setStyle({ fillColor: '#002147' }); });
                        layer.on('mouseout', function() { layer.setStyle({ fillColor: '#1E90FF' }); });
                        layer.on('click', function(e) { map.fitBounds(e.target.getBounds(), { maxZoom: 10 }); });
                    }
                }).addTo(map);
            });

        fetch('labs_3-4-25-base_conae.geojson')
            .then(response => response.json())
            .then(data => {
                var sidebar = document.getElementById('sidebar');
                
                data.features.forEach(feature => {
                    var props = feature.properties;
                    var marker = L.marker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]],{icon: laboratorioIcon})
                        .addTo(map);

                    marker.bindTooltip(`<b>${props.nombre}</b><br>${props.institucion}<br>${props.localizacion}`, { permanent: false, direction: "top", opacity: 0.9 });
marker.on('click', function () {

                   var popup = L.popup({ closeButton: true })
    .setLatLng(marker.getLatLng())
    .setContent(`
        <div style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
            <b>${props.nombre}</b><br>
            ${props.institucion}<br>
            ${props.localizacion}<br>
            ${props.direccion}<br>
            ${props.telefono}<br>
            ${props.correo}<br>
            <a href='${props.sitio_web}' target='_blank'>Sitio web</a><br>
            <b>Ensayos:</b> ${props.ensayos}<br>
            <b>Servicios:</b> ${props.servicios}<br>
            <b>Sala limpia:</b> ${props.sala_limpia}<br>
            <b>Calificaciones:</b> ${props.calificaciones}
        </div>`)
    .openOn(map);    });
            
                    marker.on('mouseover', function(e) {
                        marker.openPopup();
                        marker.setIcon(L.icon({ iconUrl: '/images/iconlab_red.png', iconSize: [58, 57] }));
                    });
                    
                    marker.on('mouseout', function(e) {
                        marker.closePopup();
                        marker.setIcon(L.icon({ iconUrl: '/images/iconlab_blue.png', iconSize: [58, 57] }));
                    }); 

                    
                    var item = document.createElement('div');
                    item.className = 'lab-item';
                    item.innerHTML = `<b>${props.nombre}</b> - ${props.institucion} -  ${props.localizacion}`;
                    item.onclick = function() {
                        map.setView(marker.getLatLng(), 8);
                        marker.fire('click');
                    };
                    sidebar.appendChild(item);
                });
            actualizarEstadisticas(data.features); //aca puse esta linea
            }
                     

                 );
    </script>

   

   

    <!-- Estadísticas de laboratorios - estilo simple y claro -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.css">

<div class="stat-panel" style="display: flex; flex-wrap: wrap; gap: 1rem; margin: 1.5rem 0;">
  <div class="stat-card" style="flex: 1; min-width: 200px; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; text-align: center; background-color: #f9f9f9;">
    <h3>Total de Laboratorios</h3>
    <p id="totalLabs" style="font-size: 1.5rem; font-weight: bold; color: #2c3e50;">0</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 200px; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; text-align: center; background-color: #f9f9f9;">
    <h3>Con Sala Limpia</h3>
    <p id="labsSalaLimpia" style="font-size: 1.5rem; font-weight: bold; color: #2980b9;">0%</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 200px; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; text-align: center; background-color: #f9f9f9;">
    <h3>Ofrecen Ensayos</h3>
    <p id="labsEnsayos" style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">0%</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 200px; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; text-align: center; background-color: #f9f9f9;">
    <h3>Ofrecen Servicios</h3>
    <p id="labsServicios" style="font-size: 1.5rem; font-weight: bold; color: #f39c12;">0%</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 200px; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; text-align: center; background-color: #f9f9f9;">
    <h3>Tienen Calificaciones</h3>
    <p id="labsCalificaciones" style="font-size: 1.5rem; font-weight: bold; color: #8e44ad;">0%</p>
  </div>
</div>
    <canvas id="labsPieChart" width="400" height="400" style="margin: 2rem auto;"></canvas>
<canvas id="provinciaPieChart" width="400" height="400" style="max-width: 400px; margin-top: 2rem;"></canvas>

    <p>2025 maqueta by Maximiliano Ozono</p>

        <script>
function actualizarEstadisticas(features) {
  const total = features.length;

  const conSalaLimpia = features.filter(f => 
    f.properties && 
    f.properties.sala_limpia && 
    f.properties.sala_limpia !== "No" && 
    f.properties.sala_limpia !== "S/D"
  ).length;

  const conEnsayos = features.filter(f => f.properties.ensayos && f.properties.ensayos !== "S/D").length;
  const conServicios = features.filter(f => f.properties.servicios && f.properties.servicios !== "S/D").length;
  const conCalificaciones = features.filter(f => f.properties.calificaciones && f.properties.calificaciones !== "S/D").length;

  const provincias = {};
  features.forEach(f => {
    const prov = f.properties.provincia?.trim();
    if (prov && prov !== "S/D") {
      if (!provincias[prov]) provincias[prov] = 0;
      provincias[prov]++;
    }
  });

  document.getElementById("totalLabs").textContent = total;
  document.getElementById("labsSalaLimpia").textContent = conSalaLimpia + " laboratorios";
  document.getElementById("labsEnsayos").textContent = conEnsayos + " laboratorios";
  document.getElementById("labsServicios").textContent = conServicios + " laboratorios";
  document.getElementById("labsCalificaciones").textContent = conCalificaciones + " laboratorios";
  document.getElementById("labsProvincias").textContent = Object.keys(provincias).length + " provincias";

  // Pie Chart por provincia
  new Chart(document.getElementById("labsProvinciasChart"), {
    type: 'pie',
    data: {
      labels: Object.keys(provincias),
      datasets: [{
        label: "Laboratorios por Provincia",
        data: Object.values(provincias),
        backgroundColor: [
          "#1abc9c", "#2ecc71", "#3498db", "#9b59b6", "#f1c40f",
          "#e67e22", "#e74c3c", "#7f8c8d", "#16a085", "#2980b9"
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        title: { display: true, text: 'Distribución por Provincia' }
      }
    }
  });
}

 actualizarEstadisticas(data.features); //aca puse esta linea
</script>
    
</body>
</html>
